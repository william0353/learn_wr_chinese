<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>数据测试</title>
    <script src="js/simpleDB.js"></script>
    <script src="js/curve.js"></script>
</head>
<body>
    <h2>数据测试页面</h2>
    <button onclick="testData()">测试数据存储</button>
    <button onclick="checkData()">检查现有数据</button>
    <div id="result"></div>

    <script>
        async function testData() {
            await initDB();
            
            // 创建测试数据
            const testHanziItem = {
                id: 'word_999',
                char: '测',
                lesson: 0,
                last_ts: Date.now(),
                stability_days: 1.0,
                ease: 2.0,
                history: [{ ts: Date.now(), correct: true }]
            };
            
            try {
                // 保存测试数据
                await learningManager.saveHanziItem(testHanziItem);
                await learningManager.markLessonCompleted(0);
                
                document.getElementById('result').innerHTML = '✅ 测试数据创建成功';
                console.log('测试数据创建成功');
            } catch (error) {
                document.getElementById('result').innerHTML = '❌ 创建失败: ' + error.message;
                console.error('创建失败:', error);
            }
        }

        async function checkData() {
            await initDB();
            
            try {
                const hanziItems = await learningManager.getAllHanziItems();
                const completedLessons = await learningManager.getCompletedLessons();
                
                const result = `
                    <h3>当前数据状态：</h3>
                    <p>汉字记录数量: ${hanziItems.length}</p>
                    <p>完成课程数量: ${completedLessons.length}</p>
                    <h4>汉字记录:</h4>
                    <pre>${JSON.stringify(hanziItems, null, 2)}</pre>
                    <h4>课程记录:</h4>
                    <pre>${JSON.stringify(completedLessons, null, 2)}</pre>
                `;
                
                document.getElementById('result').innerHTML = result;
                console.log('汉字记录:', hanziItems);
                console.log('课程记录:', completedLessons);
            } catch (error) {
                document.getElementById('result').innerHTML = '❌ 检查失败: ' + error.message;
                console.error('检查失败:', error);
            }
        }
    </script>
</body>
</html>
